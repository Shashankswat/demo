<!DOCTYPE html>
<html>
  <head>
    <title>Integrations</title>
    <meta charset="utf-8">
    <link href="../../../stylesheets/labs.css" rel="stylesheet" />
    
  </head>
  <body>
    <div class="container">
      <h1>Pre-requisites</h1>

<ul>
<li>Heroku Toolchain

<ul>
<li><a href="https://devcenter.heroku.com/articles/getting-started-with-rails5">https://devcenter.heroku.com/articles/getting-started-with-rails5</a></li>
</ul></li>
<li>Ruby

<ul>
<li>Mac/Linux - <a href="https://github.com/rbenv/rbenv#readme">https://github.com/rbenv/rbenv#readme</a></li>
<li>Windows - <a href="http://rubyinstaller.org/">http://rubyinstaller.org/</a></li>
<li>Need Ruby <code>2.2.4</code></li>
</ul></li>
<li>Create a new directory called <code>integrations</code></li>
</ul>

<h1>Webhook Sample Application</h1>

<ul>
<li>Change working directory to <code>integrations</code></li>
<li><code>git pull http://{serverurl}/developer/notifications</code></li>
<li>Change working directory to <code>notifications</code></li>
<li><code>heroku login</code></li>
<li><code>heroku create</code></li>
<li>There should be two urls returned

<ul>
<li><code>{heroku_url_1}</code> application access</li>
<li><code>{heroku_url_2}</code> git remote setup</li>
</ul></li>
</ul>

<h2>Webhook Setup</h2>

<ul>
<li><code>git checkout webhook-example</code></li>
<li>Modify the <code>config/environments/production.rb</code> file

<ul>
<li>Change the <code>config.action_cable.url</code> to use <strong>{heroku<em>url</em>1}</strong></li>
<li>Change the <code>config.action_cable.allowed_request_origins</code> to use <strong>{heroku<em>url</em>1}</strong></li>
</ul></li>
<li><code>git commit -a -m &quot;modified websocket server url&quot;</code></li>
<li><code>git push heroku webhook-example:master</code></li>
<li><code>heroku open</code></li>
<li>go to <code>https://{{heroku_url_1}}/webhooks</code></li>
</ul>

<h2>Webhook Configuration</h2>

<ul>
<li>Login as <code>chewbacca</code></li>
<li>Open your <code>notifications</code> repository on your GitHub server</li>
<li>Click on the <code>Settings</code> tab</li>
<li>Click on the <code>Webhooks</code> tab</li>
<li>Add a webhook

<ul>
<li>The URL should be <code>https://{{heroku_url_1}}/webhooks</code></li>
<li>Click the events you would like to be notified on</li>
</ul></li>
</ul>

<h2>Testing Webhooks</h2>

<ul>
<li>Trigger an event by adding an issue, doing a new push, or creating a pull request</li>
<li>Was there an update to <code>https://{{heroku_url_1}}/webhooks</code>?</li>
</ul>

<h2>Extra Credit</h2>

<ul>
<li>Modify the application to show some additional context for the webhook

<ul>
<li>If a PR or Push</li>
<li>What is the SHA?</li>
<li>What files were modified?</li>
<li>Who performed the push?</li>
<li>If an Issue</li>
<li>Title of the Issue?</li>
<li>Who created the Issue?</li>
<li>What labels are associated?</li>
</ul></li>
</ul>

<h1>OAuth Sample Application</h1>

<ul>
<li>Change working directory to <code>integrations</code></li>
<li><code>git pull http://{serverurl}/developer/notifications</code></li>
<li>Change working directory to <code>notifications</code></li>
</ul>

<h2>OAuth Setup</h2>

<ul>
<li><code>git checkout oauth-example</code></li>
<li>Add an application to your GitHub Enterprise instance with the chewbacca user

<ul>
<li>Application Name: <strong>OAuth Sample</strong></li>
<li>Homepage URL: <code>{heroku_url_1}</code></li>
<li>Authorization Callback URL: <code>{heroku_url_1}/users/auth/github/callback</code></li>
<li>Click <code>Register application</code></li>
</ul></li>
<li>Copy the <code>Client ID</code> to enter it in the <code>config/initializers/devise.rb</code></li>
<li>Copy the <code>Client Secret</code> to enter it in the <code>config/initializers/devise.rb</code></li>
<li>Enter your <code>http://{github_server_url}</code> in the <code>config/initializers/devise.rb</code></li>
<li><code>git commit -a -m &quot;modified oauth server&quot;</code></li>
<li><code>git push heroku oauth-example:master</code></li>
<li><code>heroku run rake db:migrate</code></li>
<li><code>heroku open</code></li>
<li><code>add /users/sign_in</code> after the URL

<ul>
<li>Click on the <strong>Sign In with GitHub</strong> link</li>
<li>Login as an LDAP user</li>
<li>You should be passed back to webapp</li>
</ul></li>
</ul>

<h1>Using the GitHub API</h1>

<ul>
<li><code>git checkout api-example</code></li>
<li>open <code>app/controllers/status_controller.rb</code></li>
<li>modify <code>target_url</code> to be <strong>{heroku<em>url</em>1}</strong></li>
<li>modify <code>c.api_endpoint</code> to be <strong>{ghe_dns}</strong></li>
<li><code>git commit -a -m &quot;modified api servers&quot;</code></li>
<li><code>git push heroku api-example:master</code></li>
<li><code>heroku open</code></li>
<li>go to <strong>{heroku<em>url</em>1}</strong>/status</li>
<li>go to <strong>{ghe_dns}</strong> and modify a file to create a <code>sha</code></li>
<li>copy the <code>sha</code> to the text field and hit the <code>create</code> button</li>
</ul>

<h2>Extra Credit</h2>

<ul>
<li>now make the status succeed

<ul>
<li>How is this represented in GitHub?</li>
</ul></li>
<li>now create a deployment through the API

<ul>
<li>How is this represented in GitHub?</li>
</ul></li>
</ul>

<h2>Simple Scripts with Octokit</h2>

<ul>
<li><code>git checkout simple-scripts</code></li>
<li>run the two scripts against your GitHub Enterprise instance</li>
</ul>

    </div>
  </body>
</html>
